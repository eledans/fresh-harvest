<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="style.css"> -->
    <link
      href="{{ url_for('static', filename='css/style.css') }}"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
    <title>FreshHarvest.com</title>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <a href="index.html" class="logo">
        <img
          src="{{ url_for('static', filename='images/logo.png') }}"
          alt="logo-fresh-harvest"
        />
        FreshHarvest.com
      </a>
      <nav class="navbar">
        <a href="#home">Home</a>
        <a href="#services">How It Works</a>
        <a href="#detect">Detection</a>
        <a href="#about">About</a>
      </nav>
      <div class="icon">
        <i class="fas fa-bars" id="menu-btn"></i>
      </div>
    </header>

    <!-- Home Hero Section -->
    <section class="home" id="home">
      <div class="max-width">
        <div class="home-content">
          <h3>FreshHarvest.com Background</h3>
          <p>
            FreshHarvest.com is a web-based platform that utilizes digital image
            processing and Machine Learning techniques to analyze the quality of
            fruits and vegetables. Users can upload images of fruits, and the
            website provides instant analysis results based on the freshness and
            absence of damage or defects. <br />The website has an intuitive
            interface and offers a user-friendly experience. It aims to
            revolutionize the fruit quality analysis process, providing a fast,
            objective, and accurate assessment that can help reduce food waste,
            improve food safety, and enhance market competitiveness for the
            fruit industry. <br />FreshHarvest.com serves as a valuable tool for
            fruit commodity and food industry stakeholders, enabling them to
            make informed decisions regarding the quality and grading of fruits.
          </p>
          <button class="btn">Get Started</button>
        </div>
        <div class="home-image">
          <img
            src="{{ url_for('static', filename='images/home.jpg') }}"
            alt=""
          />
        </div>
      </div>
    </section>

    <!-- Services Section -->
    <section class="services" id="services">
      <div class="max-width">
        <h2 class="title">How It Works</h2>
        <div class="serv-content">
          <div class="card">
            <div class="box">
              <img
                src="{{ url_for('static', filename='images/upload.png') }}"
                alt=""
              />
              <h3>Upload</h3>
              <p>Upload an image of a fruit.</p>
            </div>
          </div>
          <div class="card">
            <div class="box">
              <img
                src="{{ url_for('static', filename='images/object.png') }}"
                alt=""
              />
              <h3>Detect</h3>
              <p>Our model will detect the fruit.</p>
            </div>
          </div>
          <div class="card">
            <div class="box">
              <img
                src="{{ url_for('static', filename='images/results.png') }}"
                alt=""
              />
              <h3>Result</h3>
              <p>Get the result of the fruit.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Detect Section -->
    <section class="detect" id="detect">
      <div class="max-width">
        <div class="detect-content">
          <h2 class="title">Fruit Freshness Detection</h2>
          <p>
            Currently, we can detect the freshness of apple, banana, grape,
            <br />guava, jujube, orange, pomegranate, and strawberry.
          </p>
          <p><br />Please upload a picture of the fruit you want to check.</p>
          <div class="main container">
            <section class="iupload">
              <div class="row">
                <div class="img-part col-md-6">
                  <div class="image-part">
                    <video
                      autoplay
                      id="video"
                      poster="{{ url_for('static', filename='images/logo.png') }}"
                    ></video>
                    <img src="" id="photo" />
                    <canvas style="display: none" id="canvas"></canvas>
                  </div>
                  <div class="btn-part">
                    <form id="upload-data pt-3" class="">
                      <div class="input-group mt-3 row">
                        <button
                          type="button"
                          class="btn btn-primary col-md-5 col-xs-5 ml-3 mr-4"
                          id="uload"
                        >
                          Upload
                        </button>
                        <button
                          id="send"
                          type="button"
                          class="btn btn-success col-md-5 col-xs-5"
                        >
                          Predict
                        </button>
                      </div>

                      <!-- change url value  -->

                      <input
                        type="hidden"
                        class="form-control mr-2"
                        id="url"
                        placeholder="Enter REST Api url..."
                        value="../predict"
                      />
                      <input
                        name="upload"
                        type="file"
                        id="fileinput"
                        style="position: absolute; top: -500px"
                      /><br />
                    </form>
                  </div>
                </div>
                <div class="col-md-6 col-xs-12 right-part">
                  <h5 class="mb-2"><center>Prediction Results</center></h5>
                  <div class="row">
                    <div class="res-part col-xs-6">
                      <div class="jsonRes"></div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </section>
    <div id="loading"><div class="loader"></div></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script>
      let navbar = document.querySelector(".navbar");
      document.querySelector("#menu-btn").onclick = () => {
        navbar.classList.toggle("active");
      };
    </script>
    <script>
      var mybtn = document.getElementById("startbtn");
      var myvideo = document.getElementById("video");
      var mycanvas = document.getElementById("canvas");
      var myphoto = document.getElementById("photo");
      var base_data = "";

      function sendRequest(base64Data) {
        var type = "json";
        if (base64Data != "" || base64Data != null) {
          if (type == "imgtobase") {
            $(".res-part").html("");
            $(".res-part").html(base64Data);
          } else if (type == "basetoimg") {
            var imageData = $("#imgstring").val();
            $(".res-part").html("");
            $(".res-part").append(
              "<img src='data:image/jpeg;base64," + imageData + "' alt='' />"
            );
          } else {
            var url = $("#url").val();
            $("#loading").show();
            $.ajax({
              url: url,
              type: "post",
              cache: false,
              async: true,
              crossDomain: true,
              headers: {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
              },
              data: JSON.stringify({ image: base64Data }),
              success: function (res) {
                $(".res-part").html("");
                $(".res-part2").html("");
                try {
                  var imageData = res[1].image;
                  if (imageData.length > 100) {
                    if (imageData.length > 10) {
                      $(".res-part2").append(
                        "<img class='resp-img' src='data:image/jpeg;base64," +
                          imageData +
                          "' alt='' />"
                      );
                    }
                  }
                } catch (e) {}
                $(".res-part").html(
                  "<pre>" + JSON.stringify(res[0], undefined, 2) + "</pre>"
                );
                $("#loading").hide();
              },
            });
          }
        }
      }

      $(document).ready(function () {
        $("#loading").hide();

        $("#send").click(function (evt) {
          sendRequest(base_data);
        });

        $("#uload").click(function (evt) {
          $("#fileinput").focus().trigger("click");
        });
        $("#fileinput").change(function () {
          if (this.files && this.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
              var url = e.target.result;
              var img = new Image();
              img.crossOrigin = "Anonymous";
              img.onload = function () {
                var canvas = document.createElement("CANVAS");
                var ctx = canvas.getContext("2d");
                canvas.height = this.height;
                canvas.width = this.width;
                ctx.drawImage(this, 0, 0);
                base_data = canvas
                  .toDataURL("image/jpeg", 1.0)
                  .replace(/^data:image.+;base64,/, "");
                canvas = null;
              };
              img.src = url;
              $("#photo").attr("src", url);
              $("#photo").show();
              $("#video").hide();
            };
            reader.readAsDataURL(this.files[0]);
          }
        });
      });
    </script>
  </body>
</html>
